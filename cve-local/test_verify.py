#!/usr/bin/env python3
"""
Test script to verify CVE loader functionality
"""

from cve_loader_core import CVELoader
from pathlib import Path

def test_cve_loader():
    """Test the CVE loader"""
    loader = CVELoader()
    
    print(f"CVE data directory: {loader.cve_data_dir}")
    print(f"Directory exists: {loader.cve_data_dir.exists()}")
    
    # Get available years
    years = loader.get_available_years()
    print(f"Available years: {len(years)} years")
    print(f"Years: {', '.join(years[:5])}{'...' if len(years) > 5 else ''}")
    
    # Test processing a single file
    test_dir = Path('cves/2024/0xxx')
    if test_dir.exists():
        test_files = list(test_dir.glob('*.json'))
        if test_files:
            test_file = test_files[0]
            print(f"\nTesting file: {test_file.name}")
            result = loader.process_file(test_file)
            
            if result:
                print("✅ File processed successfully!")
                print(f"CVE ID: {result['cveId']}")
                print(f"State: {result.get('state', 'N/A')}")
                print(f"Description length: {len(result.get('description', ''))}")
            else:
                print("❌ Failed to process file")
        else:
            print("No JSON files found in test directory")
    else:
        print(f"Test directory {test_dir} does not exist")

if __name__ == "__main__":
    test_cve_loader()
