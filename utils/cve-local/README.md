# CVE Local Database Loader

This module provides tools to load CVE data from the local CVE dataset into a MongoDB database for the VulnTrack system.

## Quick Start

To quickly test the system and load recent CVE data, use the quick start script:

```bash
python quick_start.py
```

This will automatically load CVE data from the most recent years (2024, 2023) and provide progress information.

## Prerequisites

1. **MongoDB Running**: Make sure your MongoDB container is running:
   ```bash
   docker run -d --name mongodb-container -p 27017:27017 -e MONGO_INITDB_ROOT_USERNAME=user -e MONGO_INITDB_ROOT_PASSWORD=password mongo
   ```

2. **CVE Data**: The CVE data should be located in the `cves/` directory with the standard CVE list structure (organized by year and ID ranges).

3. **Dependencies**: The scripts require `pymongo` and other dependencies which are already included in the project's pyproject.toml.

## Available Scripts

### 1. Quick Start Script (Recommended)
```bash
python quick_start.py
```
- Loads CVE data from recent years (2024, 2023, etc.)
- Shows progress bars and statistics
- Automatically handles batch processing
- Provides summary of loaded data

### 2. Year-specific Loader
```bash
python cve_year_loader.py --year 2024 --limit 100
```

### 3. Main CVE Loader
```bash
python cve_main.py
```

## Arguments (for cve_year_loader.py)

- `--year YEAR`: Load data for a specific year (e.g., 2024, 2023)
- `--batch-size SIZE`: Number of documents to process in each batch (default: 100)
- `--limit COUNT`: Maximum number of CVEs to process (useful for testing)
- `--stats-only`: Only show database statistics without loading data

## Project Structure

```
cve-local/
├── README.md                 # This file
├── quick_start.py           # Quick start script (recommended entry point)
├── cve_main.py             # Main CVE processing script
├── cve_year_loader.py      # Year-specific CVE loader
├── cve_loader_core.py      # Core CVE loading functionality
├── test_progress_bars.py   # Progress bar testing
├── test_verify.py          # Verification tests
├── cve_loader.log          # Log file (created during execution)
└── cves/                   # CVE data directory
    ├── delta.json          # Delta information
    ├── deltaLog.json       # Delta log
    └── [YEAR]/             # Year-based directories (1999-2025)
        └── [RANGE]/        # ID range directories (0xxx, 1xxx, etc.)
            └── CVE-*.json  # Individual CVE files
```

## Database Schema

The script creates documents in MongoDB with the following structure:

```json
{
  "cveId": "CVE-2024-1000",
  "dataType": "CVE_RECORD",
  "dataVersion": "5.1",
  "state": "PUBLISHED",
  "dateReserved": "2024-01-29T06:57:07.467Z",
  "datePublished": "2024-01-29T13:31:03.916Z",
  "dateUpdated": "2024-10-18T14:24:20.440Z",
  "title": "Vulnerability title",
  "description": "Detailed description...",
  "affected": [
    {
      "vendor": "Vendor Name",
      "product": "Product Name",
      "version": "1.0.0",
      "status": "affected"
    }
  ],
  "severity": {
    "baseScore": 9.8,
    "baseSeverity": "CRITICAL",
    "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
  },
  "cweIds": ["CWE-121"],
  "references": ["https://example.com/advisory"],
  "loadedAt": "2025-06-13T10:30:00.000Z"
}
```

## Database Details

- **Host**: localhost:27017
- **Username**: user
- **Password**: password
- **Database**: cve_db
- **Collection**: vulnerabilities

## Indexes

The script automatically creates indexes on:
- `cveId` (unique)
- `datePublished`
- `severity`
- `affected.vendor`
- `affected.product`

## Recent Test Results

The system has been verified to work correctly with the local CVE dataset:

- **Total CVEs Available**: 67,738+ CVEs across all years
- **Processing Speed**: ~2.4 minutes for full dataset
- **Data Coverage**: Years 1999-2025
- **Last Verified**: June 2025

## Performance Tips

1. **Start Small**: Use `quick_start.py` for initial testing
2. **Year-specific Loading**: Use `--year 2024` to load recent data first
3. **Monitor Resources**: The full dataset can use significant storage and memory
4. **Batch Processing**: Scripts automatically handle appropriate batch sizes
5. **Progress Monitoring**: All scripts provide progress indicators and statistics

## Troubleshooting

### Common Issues

1. **MongoDB Connection**: Ensure MongoDB is running on localhost:27017
2. **CVE Data Missing**: Verify the `cves/` directory contains the CVE data structure
3. **Memory Issues**: Use smaller batch sizes for systems with limited RAM
4. **Disk Space**: Ensure sufficient space for the MongoDB database

### Logs and Debugging

- Check `cve_loader.log` for detailed processing information
- Use the test scripts to verify functionality
- Monitor MongoDB logs for database-related issues
